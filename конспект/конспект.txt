Команды	Сокращения	Описание
Use	\u	Выбор базы данных
Source	\.	Выполнение SQL-команд из файла
System	\!	Выполнение команды операционной системы

Status	\s	Вывод информации о состоиянии сервера
Exit	\q	Выход
	\G	Вертикальный вывод
Например, Select * from mysql.user Limit 1\G

Дамп
Mysqldump <наименование базы>   >  <наименование файла> 
Например
mysqldump Example > Example2.sql

развернуть дамп
mysql <название бд> < <название файла>

Основный команды

Create Database shop; 'Создать бд shop

show databases; 'показать бд

show variables like 'datadir' ; -узнать путь к каталогу данных

drop database shop; ' удалить бд shop

show tables ; показать таблицы в бд - необходимо изначально выбрать бд через команду use shop;
или
show tables from shop;


создание таблицы
Create table (
имя_столбца параметры,
имя_столбца параметры
) 

Например
Create table users (k int);
или
Create table if not exists users (k int); - не выдаст ошибку, если таблица была создана раньше


describe users; - показывает описание таблицы

create table tbl ('create' int) - в случае если столбец имеет такое же название как и команда необходимо использовать ковычки

ТИПы данных
числовые,  строковые, NULL, календарные, коллекции

Типы могут сопровождаться атрибутами - NULL и NOT NULL, Default (значение устанавливается по умолчанию), unsigned - неотрицательное число

Числовые 
целые- tinyint, smallint, mediumint, int, bigint
вещественные - float, double
точные - decimal

Create table tbl (id int(8));  используем 8 символов с типом int

insert into tbl values (5); - вставляем значение 5

Create table tbl (id int(8) zerofill);  insert into tbl values (5); - получим результат 00000005

create table tbl (price decimal (7,4)); insert into tbl values (111,2); - возможно ставить число по 7 знаков всего и 4 после запятой

Строковые
Фиксированные -  char
Переменные -  varchar
blob - tinytext, text, mediumtext, longtext

drop table if exists tbl;
create table tbl (
name char(10) Default 'anonim', - используем 10 сивмолов, значение по умолчанию anonim
description varchar(255) #максимально возможное количество символов 255
);
INSERT INTO tbl values (default, 'новый')
select * from tbl;

drop table if exists tbl;
create table tbl (
id int insigned
) comment = 'тут пишется коммент'.  -id не отрицательные и также можно использовать комментарий

если есть потребность не удалять бд а преобразовать то используется
alter table tbl change id id int unsigned not null; 
1(alter table) 2(tbl) 3(change id) 4(id int unsigned not null); 1 - ключевое выражение для преобразование, 2 - таблица, 3 - что меняем, 4 - на что меняем

truncate tbl; -  очистить таблицу

drop table if exists tbl;
create table tbl (
dateCreate Datetime Default Current_timestamp  - если дата не заполнена, то по умолчанию используем текущую
dateUpdate datetime default Current_timestamp  on update - поле обновляется при вставке или обновлении записи
)

Current_timestamp = now()

ИНДЕКСЫ
drop table if exists tbl;
create table tbl (
id int unsigned not null primary key -  айди сделали первичным ключем
)
или
drop table if exists tbl;
create table tbl (
id int unsigned not null
primary key(id)
)

drop table if exists tbl;
create table tbl (
id int unsigned not null primary key  auto_increment -  индекс автоматически создается
)


serial = bigint unsigned not null auto_increment unique

drop table if exists tbl;
create table tbl (
id serial primary key
catalog_id int insigned
key index_of_catalog_id(catalog_id) - проиндексировали поле каталог-айди
)

create index index_of_catalog_id on tbl (catalog_id) -  создать индекс в готовой таблице

create index index_of_catalog_id using btree / hash on tbl (catalog_id) -  можно указать способ работы индекса


многострочная вставка
insert into catalogs values
(null, '123'),
(null, '423'),
(null, '173');

delete from tbl; - удаляет все или часть из таблицы
truncate tbl; - удаляет все
 delete from tbl limit 2;  - удаляется 2 записи

ЗАмена записей

update 
tbl
set
name = '123'
where
name = '432';
меняет 432 на 123

вставить выбранное

insert into
tbl
select
*
from
users;

После наполнения рандомными данными, иногда есть необходимость перемешать данные. Для этого можно воспользоваь следующим запросом

Create temporary table sex (sex Char(1)); ' создаем временную таблицу
insert into sex values ('m'), ('f');  
update profiles Set sex = (Select sex  from sex order by rand() limit 1); ' set = установить значение в колонке sex

rand() - генерит дробное случайное число от 0 до 1
floor() - обрезает дробную часть
concat - склеивает слова

 Изменить тип данных
alter table media modify column metadata JSON;


Урок 5 - работа в select

between - возвращает тру если значение находится в указанном диапазоне

Select * from catalogs where id between 3 and 4;

Или 

Select * from catalogs where id not between 3 and 4;

In - можно указать список, если число есть в списке, то тру иначе false

Select * from catalogs where id in (1, 2 ,5)

Если в списке есть null, то возвращаться будет null

Like - тоже самое что и и равно, но он обладает спецсимволами:
% заменяет любое количество символов или их отсутствие
_ заменяет ровно один символ

RLIKE и REGEXP - регулярные выражения
^грам - выражение начинается на грамм
тон% - выражение заканчивается на тон
| - логическое или - например 	'abc' RLIKE 'abc|asd' - это true
[abc] - классы символов - поиск происходит по символам заключенным в скобках
[а-я] - можно указать последовательность
существуют также специальные классы, например '[[:digit:]]'
Квантификаторы
? - символ входит ноль или один раз
* - любое количество вхождений, включая ноль
+ - одно или более вхождений символа в строку
Специальные знаки такие как . Разделяются через \

Сортировка
Выполняется через команду ORDER BY <столбец>
Если нужна обратная сортировка, то добавляется команда desc
Чтобы вывести определенное количество записей можно использовать limit
Limit 2 - выводит первые 2 записи
Limit 2, 2  - выводит 2 записи после 2ой
Limit 4, 2 - выводит 2 записи после 4ой
Можно также записать limit 2 offset 4 - с 4ой выводит 2 записи
Distinct - выводит только уникальный результат
Select distinct ....
Unix_timestamp - преобразовывает дату в число
from_unixtime - из числа в дату
to_days - преобразовывает дату в дни
Если делить на количество дней, чтобы посчитать года, то не стоит забывать о високосном годе - необходимо делить на 365,25
Timestampdiff - специальная функция подсчета разницы между датами

Select * from users order by rand() - записи выводятся в случайном порядке


JSON и нормальная запись
Нормальная:
Create tables distances (
Id serial primary key,
X1 int not null,
Y1 int not null,
X2 int not null,
Y2 int not null,
Distance double as (sqrt(pow(x1 - x2,2) + pow(y1 - y2, 2)))
);

JSON:

Create tables distances (
Id serial primary key,
a json not null,
b json not null,
Distance double as (sqrt(pow(a->>'$.x' - b->>'$.x',2) + pow(a-->'$.y' - b-->'$.y', 2)))
);

Round - округление до ближайшего целого числа
Substring - разрезать строку - например substring(name,1 , 5) - получаем первые 5 символов

If - (логическое выражение, что выводится если тру, что выводится если ложь)
Select name, if (timestampdiff(Year, birthday_at, now()) >= 18, 'совершеннолетний', 'несовершеннолетний') as status from users
Вывод - новый столбец с указанием статуса совершеннолетия пользователей

Case - похож на иф в vba
Select case
	when color = 'red' then 'красный'
	when color = 'orange' then 'оранжевый'
	when color = 'green' then 'зеленый'
	else 'фиолетовый'
	end as Russian
	from
	colors;
Inet_aton - принимает ip adress

ГРУППИРОВКА ДАННЫХ
Group by - группировка по столбцу
Select Count(*) as total, decade from users group by decade; - получаем количество пользователей родившихся в десятилетие
Group_concat - возможно посмотреть содержимое группы
В group_concat есть разделитель, например Group_concat(name separator ' ')
Having - аналог where, но для сгруппированных данных

Alter table products_new rename products; - переименовали таблицу
Any_Value - возвращает случайное значение из группы

В конце запроса можно написать with rollup - добавим автосумму
